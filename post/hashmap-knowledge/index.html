<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HashMap çŸ¥è¯†ç‚¹ | Grinofith&#39;s Blog</title>
<link rel="shortcut icon" href="https://kanyewestforreal.github.io//favicon.ico?v=1741497022322">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://kanyewestforreal.github.io//styles/main.css">
<link rel="alternate" type="application/atom+xml" title="HashMap çŸ¥è¯†ç‚¹ | Grinofith&#39;s Blog - Atom Feed" href="https://kanyewestforreal.github.io//atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="åŸºç¡€
å†…éƒ¨æ•°æ®ç»“æ„
æ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘
å…è®¸ç©ºé”®ç©ºå€¼ï¼Ÿ
å…è®¸ï¼Œä½†æ˜¯ä¼šè¦†ç›–ã€‚
å½“key == nullæ—¶ï¼Œindex ä¸º 0ï¼Œå¦‚æœkey å†æ¬¡ä¸º nullï¼Œé‚£ä¹ˆæ•°æ®å°±ä¼šè¦†ç›–ã€‚
static final int hash(Object ke..." />
    <meta name="keywords" content="Java" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <!-- <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script> -->
    <script src="/media/js/highlight/highlight.min.js"></script>
    <script src="/media/js/sroll_markdown_titile_list.js"></script>
    <link rel="stylesheet" type="text/css" href="/media/js/highlight/styles/atom-one-dark.css">
    <script>hljs.highlightAll();</script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://kanyewestforreal.github.io/">
  <img class="avatar" src="https://kanyewestforreal.github.io//images/avatar.png?v=1741497022322" alt="">
  </a>
  <h1 class="site-title">
    Grinofith&#39;s Blog
  </h1>
  <p class="site-description">
    The key is seriously reflecting.
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              HashMap çŸ¥è¯†ç‚¹
            </h2>
            <div class="post-info">
              <span>
                2025-02-24
              </span>
              <span>
                11 min read
              </span>
              
                <a href="https://kanyewestforreal.github.io/tag/java/" class="post-tag">
                  # Java
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://kanyewestforreal.github.io//post-images/hashmap-knowledge.jpg" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <h1 id="åŸºç¡€">åŸºç¡€</h1>
<h2 id="å†…éƒ¨æ•°æ®ç»“æ„">å†…éƒ¨æ•°æ®ç»“æ„</h2>
<p>æ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘</p>
<h2 id="å…è®¸ç©ºé”®ç©ºå€¼">å…è®¸ç©ºé”®ç©ºå€¼ï¼Ÿ</h2>
<p>å…è®¸ï¼Œä½†æ˜¯ä¼šè¦†ç›–ã€‚</p>
<p>å½“key == nullæ—¶ï¼Œindex ä¸º 0ï¼Œå¦‚æœkey å†æ¬¡ä¸º nullï¼Œé‚£ä¹ˆæ•°æ®å°±ä¼šè¦†ç›–ã€‚</p>
<pre><code class="language-java">static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);
}
//sourceï¼šhttps://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/HashMap.java#L336C1-L339C6
</code></pre>
<h2 id="å½±å“æ€§èƒ½çš„é‡è¦å‚æ•°">å½±å“æ€§èƒ½çš„é‡è¦å‚æ•°</h2>
<p><strong>Size</strong>ï¼š HashMapçš„å½“å‰å¤§å°</p>
<p><strong>Capacity</strong>ï¼š HashMapçš„æ€»å®¹é‡ï¼Œä¸€èˆ¬æ˜¯2çš„æ¬¡å¹‚ã€‚è§£é‡Šè§ä¸‹æ–‡ <strong>å·¥ä½œåŸç†#Capacityä¸ºä»€ä¹ˆéœ€è¦æ˜¯2çš„æ¬¡å¹‚</strong></p>
<p><strong>LoadFactor</strong>ï¼š HashMapè´Ÿè½½å› å­ï¼Œé»˜è®¤å€¼ä¸º0.75fã€‚</p>
<p>è¡¡é‡HashMapæ˜¯å¦è¿›è¡Œ<strong>Resize</strong>ï¼ˆæ‰©å®¹ï¼‰çš„æ¡ä»¶å¦‚ä¸‹ï¼š</p>
<p><strong>HashMap.Size &gt;= Capacity * LoadFactor</strong></p>
<hr>
<h2 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h2>
<h3 id="putæ–¹æ³•çš„åŸç†">Putæ–¹æ³•çš„åŸç†</h3>
<pre><code class="language-java">public V put(K key, V value) {
    return putVal(hash(key), key, value, false, true);
}
//source:https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/HashMap.java#L618
</code></pre>
<p>æ¯”å¦‚è°ƒç”¨ hashMap.put(&quot;book&quot;, 0) ï¼Œæ’å…¥ä¸€ä¸ªKeyä¸ºâ€œbook&quot;çš„å…ƒç´ ï¼Œå€¼ä¸º0ã€‚</p>
<p>è¿™æ—¶ä½¿ç”¨å“ˆå¸Œå‡½æ•°hash(key)ï¼Œå¯ä»¥è®¡ç®—å‡ºEntry(é”®å€¼å¯¹) çš„æ’å…¥ä½ç½®ï¼ˆindexï¼‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œå› ä¸ºHashMapçš„é•¿åº¦æ˜¯æœ‰é™çš„ï¼Œå½“æ’å…¥çš„Entryè¶Šæ¥è¶Šå¤šæ—¶ï¼Œå¿…ç„¶ä¼šå‡ºç°indexå†²çªçš„æƒ…å†µã€‚</p>
<p>è¿™æ—¶å€™å°±æƒ³åˆ°ä½¿ç”¨ï¼ŒæŠŠEntryå¯¹è±¡è®¾ç½®ä¸ºä¸€ä¸ªNodeï¼Œæ¯ä¸€ä¸ªEntryå¯¹è±¡é€šè¿‡NextæŒ‡é’ˆæŒ‡å‘å®ƒçš„ä¸‹ä¸€ä¸ªEntryèŠ‚ç‚¹ã€‚å½“æ–°æ¥çš„Entryæ˜ å°„åˆ°å†²çªçš„æ•°ç»„ä½ç½®æ—¶ï¼Œåªéœ€è¦æ’å…¥åˆ°å¯¹åº”çš„é“¾è¡¨å³å¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–°æ¥çš„EntryèŠ‚ç‚¹æ’å…¥é“¾è¡¨æ—¶ï¼Œä½¿ç”¨çš„æ˜¯<strong>å¤´æ’æ³•</strong>ï¼Œæ˜¯å› ä¸ºHashMapçš„å‘æ˜è€…è®¤ä¸ºï¼Œ<strong>åæ’å…¥çš„Entryè¢«æŸ¥æ‰¾çš„å¯èƒ½æ€§æ›´å¤§</strong>ã€‚</p>
<h3 id="getæ–¹æ³•çš„åŸç†">Getæ–¹æ³•çš„åŸç†</h3>
<pre><code class="language-java">public V get(Object key) {
    Node&lt;K,V&gt; e;
    return (e = getNode(key)) == null ? null : e.value;
}

final Node&lt;K,V&gt; getNode(Object key) {
        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n, hash; K k;
        if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;
            (first = tab[(n - 1) &amp; (hash = hash(key))]) != null) {
            if (first.hash == hash &amp;&amp; // always check first node
                ((k = first.key) == key || (key != null &amp;&amp; key.equals(k))))
                return first;
            if ((e = first.next) != null) {
                if (first instanceof TreeNode)
                    return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);
                do {
                    if (e.hash == hash &amp;&amp;
                        ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))
                        return e;
                } while ((e = e.next) != null);
            }
        }
        return null;
}
//source: https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/HashMap.java#L563
//https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/HashMap.java#L574
</code></pre>
<p>é¦–å…ˆä¼šæŠŠè¾“å…¥çš„Keyåšä¸€æ¬¡Hashæ˜ å°„ï¼Œå¾—åˆ°å¯¹åº”çš„indexï¼Œ</p>
<p>ç”±äºåˆšæ‰æ‰€è¯´çš„Hashå†²çªï¼ŒåŒä¸€ä¸ªä½ç½®æœ‰å¯èƒ½åŒ¹é…åˆ°å¤šä¸ªEntryï¼Œè¿™æ—¶å€™å°±éœ€è¦é¡ºç€å¯¹åº”é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œä¸€ä¸ªä¸€ä¸ªå‘ä¸‹æ¥æŸ¥æ‰¾ã€‚</p>
<h3 id="capacityä¸ºä»€ä¹ˆéœ€è¦æ˜¯2çš„æ¬¡å¹‚-hashå‡½æ•°ä½¿ç”¨ä½è¿ç®—åŸå› ">Capacityä¸ºä»€ä¹ˆéœ€è¦æ˜¯2çš„æ¬¡å¹‚ï¼Ÿ&amp;&amp; Hashå‡½æ•°ä½¿ç”¨ä½è¿ç®—åŸå› </h3>
<p>æˆ‘ä»¬çŸ¥é“ä»Keyæ˜ å°„åˆ°HashMapçš„å¯¹åº”ä½ç½®Indexï¼Œä¼šç”¨åˆ°ä¸€ä¸ªhash(key)å‡½æ•°ã€‚</p>
<p>é¦–å…ˆè¦è€ƒè™‘åˆ°ï¼Œéœ€è¦å°½å¯èƒ½çš„æå‡HashMapå‡½æ•°çš„æŸ¥æ‰¾ã€æ’å…¥æ•ˆç‡ã€‚é‚£ä¹ˆhashå¾—åˆ°çš„indexåº”è¯¥å°½å¯èƒ½çš„å‡å°‘å†²çªï¼Œä¹Ÿå°±æ˜¯æ•°æ®åˆ†å¸ƒå‡åŒ€ï¼ŒåŒæ—¶hashè®¡ç®—indexçš„é€Ÿåº¦è¦å¤Ÿå¿«ã€‚</p>
<p><strong>hashå¾—åˆ°çš„indexåº”è¯¥å°½å¯èƒ½çš„å‡å°‘å†²çª</strong>ï¼šJavaä¸­HashMapçš„é»˜è®¤Capabilityè®¾ç½®ä¸º 1 &lt;&lt; 4 ï¼ˆ aka 16 ï¼‰ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä¸å–10å‘¢</strong>ï¼Ÿè¿™æ˜¯ä¸ºäº†æ•°æ®åˆ†å¸ƒçš„æ›´åŠ å‡åŒ€ï¼Œä¹Ÿå°±æ˜¯è¯´ <strong>éœ€è¦åè½åœ¨æ¯ä¸€ä¸ªIndexçš„æ¦‚ç‡ç›¸ç­‰</strong>ã€‚</p>
<blockquote>
<p>Leetcodeï¼š<a href="https://leetcode.com/problems/first-missing-positive/">41. First Missing Positive</a></p>
<p>çŸ¥é“ä¸Šè¿°åŸç†åï¼Œå¯¹äºLeetcodeè¿™ä¸€é¢˜ä¹Ÿæ˜¯ååˆ†ç®€å•çš„ã€‚æ‰‹å†™Hashå‡½æ•°ï¼Œå†Check è¿”å›ç¼ºå¤±å€¼ã€‚</p>
</blockquote>
<p>å¦åˆ™å¯¹äº</p>
<p>101110001110101110 <strong>1111</strong> &amp; 1001 (aka Capability - 1 = 10 - 1)  = 1001</p>
<p>101110001110101110 <strong>1011</strong> &amp; 1001 = 1001</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“HashMapé•¿åº¦ä¸º10çš„æ—¶å€™ï¼Œæœ‰äº›indexç»“æœçš„å‡ºç°å‡ ç‡ä¼šæ›´å¤§ï¼Œè€Œæœ‰äº›indexç»“æœæ°¸è¿œä¸ä¼šå‡ºç°.</p>
<p><strong>ä¸ºä»€ä¹ˆä¸å–2ã€4ã€8ã€32ã€64å‘¢</strong>ï¼Ÿå®˜æ–¹æ²¡æœ‰ç»™å‡ºè§£é‡Šï¼ŒçŒœæµ‹åº”è¯¥æ˜¯ä¸€ä¸ªç»éªŒå€¼ã€‚ä¹Ÿè®¸æ˜¯è€ƒè™‘åˆ°æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œè¿˜æœ‰ç©ºé—´è¿‡å¤§å¸¦æ¥çš„æµªè´¹ã€‚</p>
<p><strong>hashè®¡ç®—indexçš„é€Ÿåº¦è¦å¤Ÿå¿«</strong>ï¼šæ‰€ä»¥é€‰æ‹©ä½¿ç”¨ä½è¿ç®—&amp;ï¼Œè€Œä¸æ˜¯å–æ¨¡/å–ä½™è¿ç®—ã€‚ä¸ºä»€ä¹ˆ&amp;æ•ˆç‡æ›´é«˜å‘¢ï¼Ÿå› ä¸ºä½è¿ç®—ç›´æ¥å¯¹å†…å­˜æ•°æ®è¿›è¡Œæ“ä½œï¼Œä¸éœ€è¦è½¬æˆåè¿›åˆ¶ï¼Œæ‰€ä»¥ä½è¿ç®—è¦æ¯”å–æ¨¡è¿ç®—çš„æ•ˆç‡æ›´é«˜</p>
<hr>
<h2 id="å¤šçº¿ç¨‹ä¸å®‰å…¨é—®é¢˜">å¤šçº¿ç¨‹ä¸å®‰å…¨é—®é¢˜</h2>
<h3 id="jdk17-ä¸­hashmapæ‰©å®¹æ—¶ä½¿ç”¨-å¤´æ’æ³•æ’å…¥å…ƒç´ -ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±é™·å…¥æ­»å¾ªç¯">JDK1.7 ä¸­ï¼ŒHashMapæ‰©å®¹æ—¶ä½¿ç”¨ å¤´æ’æ³•æ’å…¥å…ƒç´  ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œé™·å…¥æ­»å¾ªç¯ã€‚</h3>
<pre><code class="language-java">/**
 * å°†å½“å‰å“ˆå¸Œè¡¨ä¸­çš„æ‰€æœ‰Entryè¿ç§»åˆ°æ–°è¡¨ä¸­ï¼ˆå“ˆå¸Œè¡¨æ‰©å®¹/ç¼©å®¹æ ¸å¿ƒæ–¹æ³•ï¼‰
 * @param newTable æ–°å“ˆå¸Œè¡¨æ•°ç»„
 * @param rehash æ˜¯å¦éœ€è¦é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼ˆä¾‹å¦‚HashMapæ‰©å®¹æ—¶ä¼šè§¦å‘ï¼‰
 */
void transfer(Entry[] newTable, boolean rehash) {
    int newCapacity = newTable.length;  // 1. è·å–æ–°è¡¨çš„å®¹é‡ï¼ˆæ–°æ•°ç»„é•¿åº¦ï¼‰
    for (Entry&lt;K,V&gt; e : table) {        // 2. éå†æ—§è¡¨çš„æ¯ä¸€ä¸ªæ¡¶ï¼ˆæ•°ç»„ä½ç½®ï¼‰
        while(null != e) {              // 3. éå†æ¡¶ä¸­çš„é“¾è¡¨ï¼ˆå¤„ç†é“¾è¡¨ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼‰
            Entry&lt;K,V&gt; next = e.next;  // 4. ä¿å­˜ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆé˜²æ­¢é“¾è¡¨æ–­è£‚ï¼‰
            if (rehash) {              // 5. å¦‚æœéœ€è¦é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼ˆä¾‹å¦‚æ‰©å®¹æ—¶ï¼‰
                // 6. é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼šå¦‚æœkeyä¸ºnullåˆ™å“ˆå¸Œ=0ï¼Œå¦åˆ™ç”¨hash()æ–¹æ³•è®¡ç®—
                e.hash = null == e.key ? 0 : hash(e.key); 
            }
            // 7. è®¡ç®—å½“å‰èŠ‚ç‚¹åœ¨æ–°è¡¨ä¸­çš„ä½ç½®ï¼ˆå–æ¨¡è¿ç®—ç®€åŒ–ä¸ºä½è¿ç®—ï¼‰
            int i = indexFor(e.hash, newCapacity);
            e.next = newTable[i];       // 8. å¤´æ’æ³•ï¼šå°†å½“å‰èŠ‚ç‚¹çš„nextæŒ‡å‘æ–°è¡¨å¯¹åº”ä½ç½®çš„é“¾è¡¨å¤´éƒ¨
            newTable[i] = e;            // 9. å°†å½“å‰èŠ‚ç‚¹è®¾ä¸ºæ–°é“¾è¡¨å¤´éƒ¨
            e = next;                   // 10. ç§»åŠ¨åˆ°é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
           
           //newTable[i] ä»£è¡¨çš„æ˜¯ä½ç½®ä¸Šçš„æœ€ä¸Šé¢é‚£æœ¬ä¹¦ï¼
            //å¤´æ’æ³•ï¼šä¸¤æ­¥èµ°ï¼Œæ‰¾å¤´å¤´ï¼Œæ”¾ä¸Šå»ã€‚
           //å‡è®¾æ–°è¡¨çš„æŸä¸ªä½ç½® i åŸæœ¬å·²ç»æœ‰ä¸€æ‘ä¹¦ï¼Œç°åœ¨è¦æŠŠä¸€æœ¬æ–°ä¹¦ e æ”¾åœ¨è¿™æ‘ä¹¦çš„æœ€ä¸Šé¢
           //e.next = newTable[i]ï¼šæŠŠæ–°ä¹¦ e çš„ä¸‹ä¸€æœ¬ï¼ˆe.nextï¼‰æŒ‡å‘ å½“å‰ä¹¦æ‘çš„æœ€ä¸Šé¢ é‚£æœ¬ä¹¦ï¼ˆnewTable[i]ï¼‰ã€‚æ­¤æ—¶ä¹¦æ‘è¿˜æ˜¯ ä¹¦A â†’ ä¹¦B â†’ nullï¼Œä½†æœ‰ e.next = ä¹¦Aï¼Œæ­¤æ—¶æ–°ä¹¦ e çš„ä¸‹ä¸€æœ¬æ˜¯ä¹¦æ‘çš„é¡¶éƒ¨ä¹¦ã€‚
           //newTable[i] = e: æŠŠæ•´ä¸ªä¹¦æ‘çš„é¡¶éƒ¨æ ‡è®°ä¸ºæ–°ä¹¦ eã€‚ç°åœ¨ä¹¦æ‘å˜æˆ e â†’ ä¹¦A â†’ ä¹¦B â†’ nullï¼Œæ–°ä¹¦ e æˆä¸ºæ–°çš„é¡¶éƒ¨ã€‚
        }
    }
}
</code></pre>
<h4 id="å…·ä½“åœºæ™¯ä¸¾ä¾‹">ğŸŒ° å…·ä½“åœºæ™¯ä¸¾ä¾‹</h4>
<p>å‡è®¾æ—§è¡¨é•¿åº¦ä¸º2ï¼Œæ–°è¡¨é•¿åº¦ä¸º4</p>
<ol>
<li>
<p><strong>åˆå§‹çŠ¶æ€</strong>ï¼š</p>
<ul>
<li>æ—§è¡¨ä¸­æœ‰ä¸¤ä¸ªæ¡¶ï¼Œå…¶ä¸­æ¡¶1çš„é“¾è¡¨ä¸ºï¼š<code>EntryA â†’ EntryB â†’ null</code>ï¼ˆå“ˆå¸Œå†²çªå¯¼è‡´é“¾è¡¨ç»“æ„ï¼‰</li>
<li>çº¿ç¨‹1å’Œçº¿ç¨‹2åŒæ—¶è§¦å‘æ‰©å®¹æ“ä½œ</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹1æ‰§è¡Œåˆ°æ­¥éª¤4</strong>ï¼š</p>
<pre><code class="language-java">Entry&lt;K,V&gt; next = e.next;  // çº¿ç¨‹1æ­¤æ—¶e=EntryAï¼Œnext=EntryB
// çº¿ç¨‹1åœ¨æ­¤å¤„è¢«æŒ‚èµ·...ï¼
</code></pre>
</li>
<li>
<p><strong>çº¿ç¨‹2å®Œæ•´æ‰§è¡Œæ•´ä¸ªtransfer</strong>ï¼š</p>
<ul>
<li>
<p>çº¿ç¨‹2å°†<code>EntryA</code>å’Œ<code>EntryB</code>è¿ç§»åˆ°æ–°è¡¨ï¼Œç”±äºå¤´æ’æ³•ï¼Œæ–°è¡¨ä¸­çš„é“¾è¡¨å˜ä¸ºï¼š</p>
<pre><code class="language-java">EntryB â†’ EntryA â†’ null
</code></pre>
</li>
<li>
<p>æ³¨æ„ï¼šå¤´æ’æ³•å¯¼è‡´é“¾è¡¨é¡ºåºåè½¬</p>
</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹1æ¢å¤æ‰§è¡Œ</strong>ï¼š</p>
<ul>
<li>
<p>çº¿ç¨‹1ä»æŒæœ‰æ—§çš„é“¾è¡¨å¼•ç”¨ï¼š<code>e=EntryA</code>ï¼Œ<code>next=EntryB</code></p>
</li>
<li>
<p>ç»§ç»­æ‰§è¡Œè¿ç§»ï¼š</p>
<pre><code class="language-java">int i = indexFor(e.hash, newCapacity);  // è®¡ç®—EntryAçš„ä½ç½®
e.next = newTable[i];  // æ­¤æ—¶æ–°è¡¨è¯¥ä½ç½®å·²è¢«çº¿ç¨‹2å†™å…¥EntryBï¼Œæ‰€ä»¥EntryA.next = EntryB
newTable[i] = e;       // å°†EntryAè®¾ä¸ºé“¾è¡¨å¤´éƒ¨ï¼ˆæ­¤æ—¶é“¾è¡¨å˜æˆEntryA â†’ EntryBï¼‰
e = next;              // e=EntryBï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
</code></pre>
</li>
<li>
<p>å¤„ç†EntryBæ—¶ï¼š</p>
<pre><code class="language-java">Entry&lt;K,V&gt; next = e.next;  // EntryB.nextåŸæœ¬æ˜¯nullï¼ˆçº¿ç¨‹2è¿ç§»åçš„çŠ¶æ€ï¼‰
int i = indexFor(e.hash, newCapacity);
e.next = newTable[i];      // æ–°è¡¨è¯¥ä½ç½®å½“å‰æ˜¯EntryAï¼Œæ‰€ä»¥EntryB.next = EntryA
newTable[i] = e;           // é“¾è¡¨å˜æˆEntryB â†’ EntryA â†’ EntryBï¼ˆå½¢æˆç¯ï¼ï¼‰
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>æœ€ç»ˆç»“æœ</strong>ï¼š</p>
<ul>
<li>æ–°è¡¨ä¸­å‡ºç°ç¯å½¢é“¾è¡¨ï¼š<code>EntryB â†’ EntryA â†’ EntryB</code></li>
<li>åç»­å¯¹è¯¥é“¾è¡¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼ŒCPUä¼šå› æ­»å¾ªç¯å¯¼è‡´100%å ç”¨ï¼</li>
</ul>
</li>
</ol>
<hr>
<h3 id="jdk18-ä¸­å¦‚æœä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ-put-æ“ä½œå¹¶ä¸”ä¸¤ä¸ªæ•°æ®çš„-hash-å€¼å†²çªå°±å¯èƒ½å‡ºç°æ•°æ®è¦†ç›–">JDK1.8 ä¸­ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ put æ“ä½œï¼Œå¹¶ä¸”ä¸¤ä¸ªæ•°æ®çš„ hash å€¼å†²çªï¼Œå°±å¯èƒ½å‡ºç°æ•°æ®è¦†ç›–ã€‚</h3>
<h4 id="å…·ä½“åœºæ™¯ä¸¾ä¾‹-2">ğŸŒ° å…·ä½“åœºæ™¯ä¸¾ä¾‹</h4>
<p>å‡è®¾å“ˆå¸Œè¡¨åˆå§‹çŠ¶æ€å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ¡¶ä½ç½® <code>i</code> ä¸ºç©ºï¼ˆ<code>table[i] = null</code>ï¼‰ã€‚</li>
<li>çº¿ç¨‹Aå’Œçº¿ç¨‹BåŒæ—¶è°ƒç”¨ <code>put(key1, value1)</code> å’Œ <code>put(key2, value2)</code>ï¼Œä¸” <code>key1</code> å’Œ <code>key2</code> å“ˆå¸Œå†²çªï¼ˆå³ <code>hash(key1) = hash(key2)</code>ï¼‰ã€‚</li>
</ul>
<ol>
<li>
<p><strong>çº¿ç¨‹Aæ‰§è¡Œåˆ°æ’å…¥é€»è¾‘</strong>ï¼š</p>
<pre><code class="language-java">// ä¼ªä»£ç ï¼šåˆ¤æ–­æ¡¶ä½ç½®æ˜¯å¦ä¸ºç©º
if ((p = table[i]) == null) {
    // ç›´æ¥æ’å…¥æ–°èŠ‚ç‚¹ï¼ˆçº¿ç¨‹Aåœ¨æ­¤å¤„è¢«æŒ‚èµ·ï¼‰
    table[i] = newNode(hash, key1, value1, null);
}
</code></pre>
<ul>
<li>çº¿ç¨‹Aå‘ç° <code>table[i]</code> ä¸ºç©ºï¼Œå‡†å¤‡æ’å…¥æ–°èŠ‚ç‚¹ <code>Node(key1, value1)</code>ï¼Œä½†<strong>å°šæœªæ‰§è¡Œèµ‹å€¼æ“ä½œ</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹BæŠ¢å æ‰§è¡Œ</strong>ï¼š</p>
<pre><code class="language-java">if ((p = table[i]) == null) {
    // çº¿ç¨‹Bå‘ç°table[i]ä»ä¸ºç©ºï¼ˆå› ä¸ºçº¿ç¨‹Aè¿˜æœªæ‰§è¡Œèµ‹å€¼ï¼‰
    table[i] = newNode(hash, key2, value2, null);
}
</code></pre>
<ul>
<li>çº¿ç¨‹Bç›´æ¥æ’å…¥ <code>Node(key2, value2)</code>ï¼Œæ­¤æ—¶ <code>table[i]</code> è¢«èµ‹å€¼ä¸ºæ–°èŠ‚ç‚¹ã€‚</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹Aæ¢å¤æ‰§è¡Œ</strong>ï¼š</p>
<pre><code class="language-java">table[i] = newNode(hash, key1, value1, null); // è¦†ç›–çº¿ç¨‹Bçš„æ’å…¥
</code></pre>
<ul>
<li>çº¿ç¨‹Aç»§ç»­æ‰§è¡Œèµ‹å€¼æ“ä½œï¼ˆä¸ä¼šå†æ¬¡æ£€æŸ¥table[i]æ˜¯å¦ä¸ºç©ºï¼‰ï¼Œ<strong>è¦†ç›–çº¿ç¨‹Bå·²æ’å…¥çš„èŠ‚ç‚¹</strong>ã€‚æœ€ç»ˆ <code>table[i]</code> ä¸­ä»…ä¿ç•™ <code>Node(key1, value1)</code>ï¼Œ<code>key2</code> çš„æ•°æ®å½»åº•ä¸¢å¤±ï¼</li>
</ul>
</li>
</ol>
<hr>
<h2 id="jdk-18çš„ä¼˜åŒ–">JDK 1.8çš„ä¼˜åŒ–</h2>
<p>HashMapä¸­Entryçš„é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰æ—¶ï¼Œå°±ä¼šå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼ˆå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼‰ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><strong>è§£å†³æ–¹æ¡ˆ</strong></h2>
<ol>
<li>
<p><strong>é¿å…å…±äº«çŠ¶æ€</strong>ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå°½é‡ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ç‹¬ç«‹çš„HashMapå®ä¾‹ã€‚</p>
</li>
<li>
<p><strong>åŒæ­¥é”</strong>ï¼šå¯¹HashMapçš„å†™æ“ä½œåŠ é”ï¼ˆå¦‚ <code>synchronized</code>ï¼‰ï¼Œä½†ä¼šå¤§å¹…é™ä½æ€§èƒ½ã€‚</p>
<pre><code class="language-java">synchronized(map) {
    map.put(key, value);
}
</code></pre>
</li>
<li>
<p><strong>çº¿ç¨‹å®‰å…¨å®¹å™¨</strong>ï¼šç›´æ¥ä½¿ç”¨<code>ConcurrentHashMap</code>æ›¿ä»£HashMapï¼Œå…¶å†…éƒ¨é€šè¿‡åˆ†æ®µé”ï¼ˆJDK7ï¼‰æˆ–CAS+synchronizedï¼ˆJDK8ï¼‰ä¿è¯å¹¶å‘å®‰å…¨ã€‚</p>
<pre><code class="language-java">Map&lt;String, Object&gt; safeMap = new ConcurrentHashMap&lt;&gt;();
safeMap.put(key, value); // æ— éœ€é¢å¤–åŒæ­¥
</code></pre>
</li>
</ol>
<hr>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<blockquote>
<p>https://juejin.cn/post/6844903518264885256</p>
<p>https://juejin.cn/post/6844903518331994119</p>
<p>https://cloud.tencent.com/developer/article/2427109</p>
</blockquote>
<h1 id="è¿›é˜¶">è¿›é˜¶</h1>
<p>ConcurrentHashMap<br>
TODO</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#%E5%9F%BA%E7%A1%80">åŸºç¡€</a>
<ul>
<li><a href="#%E5%86%85%E9%83%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">å†…éƒ¨æ•°æ®ç»“æ„</a></li>
<li><a href="#%E5%85%81%E8%AE%B8%E7%A9%BA%E9%94%AE%E7%A9%BA%E5%80%BC">å…è®¸ç©ºé”®ç©ºå€¼ï¼Ÿ</a></li>
<li><a href="#%E5%BD%B1%E5%93%8D%E6%80%A7%E8%83%BD%E7%9A%84%E9%87%8D%E8%A6%81%E5%8F%82%E6%95%B0">å½±å“æ€§èƒ½çš„é‡è¦å‚æ•°</a></li>
<li><a href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">å·¥ä½œåŸç†</a>
<ul>
<li><a href="#put%E6%96%B9%E6%B3%95%E7%9A%84%E5%8E%9F%E7%90%86">Putæ–¹æ³•çš„åŸç†</a></li>
<li><a href="#get%E6%96%B9%E6%B3%95%E7%9A%84%E5%8E%9F%E7%90%86">Getæ–¹æ³•çš„åŸç†</a></li>
<li><a href="#capacity%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%98%AF2%E7%9A%84%E6%AC%A1%E5%B9%82-hash%E5%87%BD%E6%95%B0%E4%BD%BF%E7%94%A8%E4%BD%8D%E8%BF%90%E7%AE%97%E5%8E%9F%E5%9B%A0">Capacityä¸ºä»€ä¹ˆéœ€è¦æ˜¯2çš„æ¬¡å¹‚ï¼Ÿ&amp;&amp; Hashå‡½æ•°ä½¿ç”¨ä½è¿ç®—åŸå› </a></li>
</ul>
</li>
<li><a href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98">å¤šçº¿ç¨‹ä¸å®‰å…¨é—®é¢˜</a>
<ul>
<li><a href="#jdk17-%E4%B8%ADhashmap%E6%89%A9%E5%AE%B9%E6%97%B6%E4%BD%BF%E7%94%A8-%E5%A4%B4%E6%8F%92%E6%B3%95%E6%8F%92%E5%85%A5%E5%85%83%E7%B4%A0-%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1%E9%99%B7%E5%85%A5%E6%AD%BB%E5%BE%AA%E7%8E%AF">JDK1.7 ä¸­ï¼ŒHashMapæ‰©å®¹æ—¶ä½¿ç”¨ å¤´æ’æ³•æ’å…¥å…ƒç´  ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œé™·å…¥æ­»å¾ªç¯ã€‚</a>
<ul>
<li><a href="#%E5%85%B7%E4%BD%93%E5%9C%BA%E6%99%AF%E4%B8%BE%E4%BE%8B">ğŸŒ° å…·ä½“åœºæ™¯ä¸¾ä¾‹</a></li>
</ul>
</li>
<li><a href="#jdk18-%E4%B8%AD%E5%A6%82%E6%9E%9C%E4%B8%A4%E4%B8%AA%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E6%89%A7%E8%A1%8C-put-%E6%93%8D%E4%BD%9C%E5%B9%B6%E4%B8%94%E4%B8%A4%E4%B8%AA%E6%95%B0%E6%8D%AE%E7%9A%84-hash-%E5%80%BC%E5%86%B2%E7%AA%81%E5%B0%B1%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E6%95%B0%E6%8D%AE%E8%A6%86%E7%9B%96">JDK1.8 ä¸­ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ put æ“ä½œï¼Œå¹¶ä¸”ä¸¤ä¸ªæ•°æ®çš„ hash å€¼å†²çªï¼Œå°±å¯èƒ½å‡ºç°æ•°æ®è¦†ç›–ã€‚</a>
<ul>
<li><a href="#%E5%85%B7%E4%BD%93%E5%9C%BA%E6%99%AF%E4%B8%BE%E4%BE%8B-2">ğŸŒ° å…·ä½“åœºæ™¯ä¸¾ä¾‹</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#jdk-18%E7%9A%84%E4%BC%98%E5%8C%96">JDK 1.8çš„ä¼˜åŒ–</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><strong>è§£å†³æ–¹æ¡ˆ</strong></a></li>
<li><a href="#%E5%8F%82%E8%80%83">å‚è€ƒ</a></li>
</ul>
</li>
<li><a href="#%E8%BF%9B%E9%98%B6">è¿›é˜¶</a></li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://kanyewestforreal.github.io/post/interlude/">
              <h3 class="post-title">
                Interlude
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  This blog is just for me to record the questions, which in my developing.
  <a class="rss" href="https://kanyewestforreal.github.io//atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
